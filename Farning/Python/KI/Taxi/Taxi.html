<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taxi</title>
    <style>
        body{
            font-family: "Helvetica Neue";
            text-align: center;
            background-color: rgb(255, 255, 255);
        }
        h1 {
            font-size: 5vw;
        }
        #spiel {
            display: table;
            margin: auto;
            border: 1vw solid black
        }
        .table-row {
            display: table-row;
        }
        .table-cell{
            display: table-cell;
            width: 10vw;
            height: 10vw;
            vertical-align: middle;
            background-color: rgb(255, 255, 255);
            border: 0.3vw solid black
        }
        .table-cell img {
            width: 9vw;
        }
        .blue {
            background-color: rgb(80, 109, 204);
        }
        .start {
            background-color:  rgb(172, 191, 255);
        }
        .goal {
            background-color: rgb(136, 230, 136);
        }
    </style>
</head>

<body>
    <h1>Taxi</h1>
    <div id="spiel"0>
        <div class = "table-row">
            <div id = "00" class = "table-cell">
                <img>
            </div> 
            <div id = "01" class = "table-cell">
                <img>
            </div> 
            <div id = "02" class = "table-cell">
                <img>
            </div> 
            <div id = "03" class = "table-cell">
                <img>
            </div> 
            <div id = "04" class = "table-cell">
                <img>
            </div> 
        </div>   
        <div class = "table-row">
            <div id = "10" class = "table-cell">
                <img>
            </div> 
            <div id = "11" class = "table-cell">
                <img>
            </div> 
            <div id = "12" class = "table-cell">
                <img>
            </div> 
            <div id = "13" class = "table-cell">
                <img>
            </div> 
            <div id = "14" class = "table-cell">
                <img>
            </div> 
        </div>   
        <div class = "table-row">
            <div id = "20" class = "table-cell">
                <img>
            </div> 
            <div id = "21" class = "table-cell">
                <img>
            </div> 
            <div id = "22" class = "table-cell">
                <img>
            </div> 
            <div id = "23" class = "table-cell">
                <img>
            </div> 
            <div id = "24" class = "table-cell">
                <img>
            </div> 
        </div> 
        <div class = "table-row">
            <div id = "30" class = "table-cell">
                <img>
            </div> 
            <div id = "31" class = "table-cell">
                <img>
            </div> 
            <div id = "32" class = "table-cell">
                <img>
            </div> 
            <div id = "33" class = "table-cell">
                <img>
            </div> 
            <div id = "34" class = "table-cell">
                <img>
            </div> 
        </div>   
        <div class = "table-row">
            <div id = "40" class = "table-cell">
                <img>
            </div> 
            <div id = "41" class = "table-cell">
                <img>
            </div> 
            <div id = "42" class = "table-cell">
                <img>
            </div> 
            <div id = "43" class = "table-cell">
                <img>
            </div> 
            <div id = "44" class = "table-cell">
                <img>
            </div> 
        </div>     
    </div>
    <div id="text"0></div>
<script>
    function stopper(condition){
        return new Promise((resolve) => {
            const intervall = setInterval(() => {
                if (condition["value"]) {
                    clearInterval(intervall);
                    resolve();
                }
            }, 200)
        })
    }
    
    class Umwelt{
        constructor(){
            this.position = this.generatePosition()
            this.lastposition = structuredClone(this.position)
            this.passengerpositions = []
            while (this.passengerpositions.length < 4){
                let generatedPosition = this.getIndexfromList(this.generatePosition())
                if (!this.passengerpositions.includes(generatedPosition))
                    this.passengerpositions.push(generatedPosition)
            }
            for (let i = 0; i < this.passengerpositions.length; i++){
                this.passengerpositions[i] = this.getListfromIndex(this.passengerpositions[i])
            }
            this.start = this.passengerpositions[Math.floor(Math.random() * this.passengerpositions.length)]
            this.end = this.passengerpositions[Math.floor(Math.random() * this.passengerpositions.length)]
            while (this.start === this.end){
                this.end = this.passengerpositions[Math.floor(Math.random() * this.passengerpositions.length)]
            }
            this.hasupdated = {"value": false}
            this.hasmoved = {"value": false}
        }
        
        generatePosition(){
            return [Math.floor(Math.random() * 5), Math.floor(Math.random() * 5)]
        }
        
        getPosition(){
            return this.position
        }

        getPassengerpositions(){
            return this.passengerpositions
        }

        getStart(){
            return this.start
        }

        getEnd(){
            return this.end
        }

        getListfromIndex(index){
            return [parseInt(index[0]), parseInt(index[1])]
        }

        getIndexfromList(list){
            return "" + list[0] + list[1]
        }

        initialdraw(){
            for (let i = 0; i < this.passengerpositions.length; i++){
                document.getElementById(this.getIndexfromList(this.passengerpositions[i])).classList.add("blue")
            }
            document.getElementById(this.getIndexfromList(this.start)).classList.add("start")
            document.getElementById(this.getIndexfromList(this.end)).classList.add("goal")
            document.getElementById(this.getIndexfromList(this.position)).children[0].src = "taxi.png"
            document.getElementById("text").textContent = "Passenger: on start"
        }

        sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async update(){
            await stopper(this.hasmoved)
            document.getElementById(this.getIndexfromList(this.lastposition)).children[0].style.visibility = "hidden"
            document.getElementById(this.getIndexfromList(this.position)).children[0].style.visibility = "visible"
            document.getElementById(this.getIndexfromList(this.position)).children[0].src = "taxi.png"
            this.hasupdated["value"] = true
            this.hasmoved["value"] = false
        }

        async move(action){
            this.lastposition = structuredClone(this.position)
            switch(action){
                case 0:
                    if (this.position[0]+ 1 < 5){
                        this.position = [this.position[0] + 1, this.position[1]]
                    }
                    break;
                case 1:
                    if (this.position[0] - 1 >= 0){
                        this.position = [this.position[0] - 1, this.position[1]]
                    }
                    break;
                case 2:
                    if (this.position[1] + 1 < 5){
                        this.position = [this.position[0], this.position[1] + 1]
                    }
                    break;
                case 3:
                    if (this.position[1] - 1 >= 0){
                        this.position = [this.position[0], this.position[1] - 1]
                    }
                    break;
                case 4:
                    if (this.position[0] - 1 >= 0){
                        this.position = [this.position[0] - 1, this.position[1]]
                    }
                    break;
                case 5:
                    if (this.position[0] - 1 >= 0){
                        this.position = [this.position[0] - 1, this.position[1]]
                    }
                    break;
            }
            this.update()
            this.hasmoved["value"] = true
            await stopper(this.hasupdated)
            this.hasupdated["value"] = false
            return
        }
    }

    class Agent{
        constructor(){
            this.umwelt = new Umwelt()
        }
    }

    e = new Umwelt()
    e.initialdraw()
    async function run() {
        await e.move(0)
        await e.move(1)
        await e.move(2)
        await e.move(0)
        await e.move(1)
        await e.move(0)
        await e.move(1)
        await e.move(2)
        await e.move(0)
        await e.move(1)
        await e.move(0)
        await e.move(1)
        await e.move(2)
        await e.move(0)
        await e.move(1)
        await e.move(0)
        await e.move(1)
        await e.move(2)
        await e.move(0)
        await e.move(1)
    }

    run()
    
</script>
</body>
</html>